---
# Storage Element ConfigMap
# Физическое хранение файлов с кешированием метаданных
apiVersion: v1
kind: ConfigMap
metadata:
  name: storage-element-config
  namespace: artstore
  labels:
    app: storage-element
    component: backend
data:
  # Application Configuration
  APP_NAME: "ArtStore Storage Element"
  APP_VERSION: "1.0.0"
  APP_ENVIRONMENT: "production"

  # Server Configuration
  SERVER_HOST: "0.0.0.0"
  SERVER_PORT: "8010"
  SERVER_WORKERS: "4"

  # Storage Element Identification
  STORAGE_ELEMENT_ID: "storage-01"  # Уникальный ID для Service Discovery
  STORAGE_ELEMENT_NAME: "Primary Storage"
  STORAGE_ELEMENT_MODE: "edit"  # edit, rw, ro, ar

  # Storage Backend Configuration
  STORAGE_BACKEND: "s3"  # local или s3
  STORAGE_BASE_PATH: "/data/storage"  # Для local storage
  STORAGE_MAX_FILE_SIZE: "1073741824"  # 1GB в байтах

  # S3 Configuration (MinIO)
  S3_ENDPOINT_URL: "http://minio.artstore.svc.cluster.local:9000"
  S3_REGION: "us-east-1"
  S3_USE_SSL: "false"  # true для production с настроенным TLS

  # Database Configuration (PostgreSQL async asyncpg)
  DATABASE_HOST: "postgres.artstore.svc.cluster.local"
  DATABASE_PORT: "5432"
  DATABASE_NAME: "artstore"
  DATABASE_TABLE_PREFIX: "storage_elem_01"  # Уникальный префикс для таблиц
  DATABASE_POOL_SIZE: "20"
  DATABASE_MAX_OVERFLOW: "10"

  # Redis Configuration (СИНХРОННЫЙ режим - redis-py!)
  REDIS_HOST: "redis.artstore.svc.cluster.local"
  REDIS_PORT: "6379"
  REDIS_DB: "1"  # DB 1 для storage-element (DB 0 для admin-module)

  # JWT Validation Configuration
  JWT_ALGORITHM: "RS256"
  # JWT_PUBLIC_KEY берется из Secret

  # Attribute File Configuration
  ATTR_FILE_MAX_SIZE: "4096"  # 4KB максимум для атомарности записи
  ATTR_FILE_SUFFIX: ".attr.json"

  # Write-Ahead Log Configuration
  WAL_ENABLED: "true"
  WAL_SYNC_MODE: "fsync"  # fsync для durability

  # Retention Configuration
  RETENTION_CHECK_INTERVAL: "3600"  # Проверка каждый час
  RETENTION_WARNING_DAYS: "7"  # Предупреждение за 7 дней до истечения

  # CORS Configuration
  CORS_ALLOW_ORIGINS: "*"
  CORS_ALLOW_CREDENTIALS: "true"
  CORS_ALLOW_METHODS: "GET,POST,PUT,DELETE,PATCH"

  # Monitoring Configuration
  METRICS_ENABLED: "true"
  METRICS_PATH: "/metrics"
  TRACING_ENABLED: "true"

  # Health Check Configuration
  HEALTH_CHECK_ENABLED: "true"
  HEALTH_LIVE_PATH: "/health/live"
  HEALTH_READY_PATH: "/health/ready"

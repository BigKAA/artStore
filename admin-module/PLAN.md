# План разработки модуля admin-module

## 1. Настройка окружения и структуры проекта
- Создать базовую структуру каталогов для исходного кода, тестов и конфигураций.
- Настроить виртуальное окружение Python.
- Установить зависимости: FastAPI, SQLAlchemy, psycopg2-binary, passlib, python-jose, etc.

## 2. Реализация модели данных для локальных пользователей
- Определить модель SQLAlchemy для таблицы пользователей (User) и групп (Group).
- Поля User: id, username, email, hashed_password, full_name, is_active, is_admin, created_at, updated_at.
- Поля Group: id, name, description.
- Создать связующую таблицу для отношения "многие-ко-многим" между пользователями и группами.
- Создать миграцию базы данных.

## 3. Реализация аутентификации для локальных пользователей
- Реализовать функции для хеширования и проверки паролей (bcrypt).
- Создать сервис для проверки учетных данных локального пользователя.

## 4. Реализация механизма JWT токенов (RS256)
- Реализовать генерацию ключевой пары RS256.
- Создать функции для создания `access` и `refresh` JWT токенов.
- `access_token` должен содержать user_id и роли/группы.
- Реализовать функцию для проверки и декодирования `access_token`.

## 5. Реализация CRUD для локальных пользователей и групп
- Создать сервисные функции для CRUD операций с пользователями и группами.
- Реализовать добавление/удаление пользователей из групп.

## 6. Реализация API для локальной аутентификации и управления пользователями
- Создать роутеры FastAPI для:
    - `/api/auth/login`: Аутентификация и выдача токенов.
    - `/api/auth/refresh`: Обновление `access_token`.
    - `/api/auth/me`: Получение информации о текущем пользователе.
    - `/api/users/`: CRUD операции для пользователей.
    - `/api/groups/`: CRUD операции для групп.

## 7. Проектирование и реализация интеграции с LDAP
- Спроектировать абстрактный слой для работы с разными источниками пользователей (локальная база, LDAP, OAuth2).
- Реализовать сервис для аутентификации через LDAP.
- Реализовать сервис для синхронизации пользователей и групп из LDAP в локальную базу данных.
- Добавить эндпоинты для управления конфигурацией LDAP.

## 8. Проектирование и реализация интеграции с OAuth2
- Реализовать поддержку OAuth2/OIDC провайдеров.
- Создать эндпоинты для callback'ов от OAuth2 провайдеров.
- Реализовать логику создания/связывания локальных пользователей с профилями OAuth2.

## 9. Написание Unit-тестов
- Написать тесты для всех сервисов: локальная аутентификация, LDAP, OAuth2.
- Написать тесты для CRUD операций.
- Написать тесты для всех API эндпоинтов.

## 10. Подготовка Dockerfile и конфигурации для сборки
- Создать `Dockerfile` для сборки приложения.
- Обновить `docker-compose-app.yml` для запуска сервиса `admin-module`.
- Настроить передачу конфигурации (включая секции для LDAP и OAuth2) через переменные окружения.
# Admin Module Configuration
# Этот файл содержит базовую конфигурацию для Admin Module

# Информация о приложении
app:
  name: "ArtStore Admin Module"
  version: "1.0.0"
  description: "Центр аутентификации и управления системой ArtStore"
  debug: false

# Настройки сервера
server:
  host: "0.0.0.0"
  port: 8000
  workers: 4
  reload: false
  log_level: "info"

# База данных PostgreSQL
database:
  host: "localhost"
  port: 5432
  username: "artstore"
  password: "password"
  database: "artstore_admin"
  pool_size: 10
  max_overflow: 20
  pool_timeout: 30
  pool_recycle: 3600
  echo: false

# Redis для Service Discovery и кеширования
redis:
  # Режим работы: standalone (разработка) | cluster (production)
  mode: "standalone"  # standalone | cluster

  # Standalone режим (для разработки)
  host: "localhost"
  port: 6379
  password: ""
  db: 0

  # Cluster режим (для production)
  cluster:
    # Список узлов кластера (минимум 6: 3 master + 3 replica)
    nodes:
      - host: "redis-cluster-1"
        port: 6379
      - host: "redis-cluster-2"
        port: 6379
      - host: "redis-cluster-3"
        port: 6379
      - host: "redis-cluster-4"
        port: 6379
      - host: "redis-cluster-5"
        port: 6379
      - host: "redis-cluster-6"
        port: 6379
    password: ""
    # Максимальное количество редиректов при работе с кластером
    max_redirects: 3
    # Таймаут на инициализацию кластера
    cluster_init_timeout: 10

  # Connection pool
  max_connections: 50
  socket_timeout: 5
  socket_connect_timeout: 5

# JWT аутентификация
auth:
  jwt:
    algorithm: "RS256"
    private_key_path: "./keys/jwt-private.pem"
    public_key_path: "./keys/jwt-public.pem"
    access_token_expire_minutes: 30
    refresh_token_expire_days: 7

  # Ротация ключей
  key_rotation:
    enabled: true
    interval_hours: 24

  # Политика паролей
  password_policy:
    min_length: 12
    require_uppercase: true
    require_lowercase: true
    require_digits: true
    require_special: true
    max_age_days: 90

# LDAP интеграция (опционально)
ldap:
  enabled: false
  server: "ldap://localhost:389"
  bind_dn: "cn=admin,dc=example,dc=com"
  bind_password: "admin_password"
  base_dn: "dc=example,dc=com"
  user_search_filter: "(uid={username})"
  timeout: 10

# OAuth2/OIDC интеграция (опционально)
oauth:
  enabled: false
  providers:
    google:
      client_id: "your-google-client-id"
      client_secret: "your-google-client-secret"
      authorize_url: "https://accounts.google.com/o/oauth2/v2/auth"
      token_url: "https://oauth2.googleapis.com/token"
    github:
      client_id: "your-github-client-id"
      client_secret: "your-github-client-secret"
      authorize_url: "https://github.com/login/oauth/authorize"
      token_url: "https://github.com/login/oauth/access_token"

# Service Discovery
service_discovery:
  enabled: true
  publish_interval_seconds: 30
  health_check_interval_seconds: 10
  service_ttl_seconds: 60

# Raft Consensus для кластера Admin Module
raft:
  enabled: false  # true для production кластера
  node_id: "admin-node-1"
  cluster_nodes:
    - id: "admin-node-1"
      host: "localhost"
      port: 8000
    - id: "admin-node-2"
      host: "localhost"
      port: 8001
    - id: "admin-node-3"
      host: "localhost"
      port: 8002
  election_timeout_ms: 1000
  heartbeat_interval_ms: 100
  data_dir: "./raft-data"

# Vector Clocks для глобального упорядочивания
vector_clock:
  enabled: true
  node_id: "admin-node-1"

# Saga Pattern для распределенных транзакций
saga:
  enabled: true
  timeout_seconds: 300
  retry_attempts: 3
  retry_delay_seconds: 5

# Kafka для асинхронной обработки
kafka:
  enabled: false
  bootstrap_servers:
    - "localhost:9092"
  topic_prefix: "artstore"
  consumer_group: "admin-module"

# Мониторинг
monitoring:
  # Prometheus metrics
  prometheus:
    enabled: true
    endpoint: "/metrics"

  # OpenTelemetry tracing
  tracing:
    enabled: true
    jaeger_host: "localhost"
    jaeger_port: 6831
    service_name: "admin-module"

  # Health checks
  health:
    enabled: true
    endpoints:
      liveness: "/health/live"
      readiness: "/health/ready"

# Логирование
logging:
  level: "INFO"  # DEBUG | INFO | WARNING | ERROR | CRITICAL
  format: "json"  # json | text
  output: "stdout"  # stdout | file
  file_path: "./logs/admin-module.log"
  max_file_size_mb: 100
  backup_count: 5

  # Audit logging
  audit:
    enabled: true
    log_all_requests: false
    log_auth_events: true
    log_admin_actions: true

# CORS настройки
cors:
  enabled: true
  allow_origins:
    - "http://localhost:4200"
    - "http://localhost:3000"
  allow_credentials: true
  allow_methods:
    - "GET"
    - "POST"
    - "PUT"
    - "DELETE"
    - "OPTIONS"
  allow_headers:
    - "Authorization"
    - "Content-Type"
    - "X-Request-ID"

# Rate Limiting
rate_limiting:
  enabled: true
  default_limit: 100
  default_period_seconds: 60

  # Специальные лимиты для эндпоинтов
  endpoints:
    "/api/auth/login":
      limit: 5
      period_seconds: 60
    "/api/auth/register":
      limit: 3
      period_seconds: 300

# Security настройки
security:
  # TLS/SSL
  tls:
    enabled: false
    cert_file: "./certs/server.crt"
    key_file: "./certs/server.key"

  # Защита от брутфорса
  brute_force_protection:
    enabled: true
    max_attempts: 5
    lockout_duration_minutes: 15

  # IP Whitelisting для админских операций
  ip_whitelist:
    enabled: false
    addresses:
      - "127.0.0.1"
      - "::1"

# Системные настройки
system:
  # Защита системного администратора
  protect_system_admin: true
  system_admin_username: "admin"

  # Резервное копирование
  backup:
    enabled: true
    schedule: "0 2 * * *"  # Cron выражение (каждый день в 2 AM)
    retention_days: 30
    backup_dir: "./backups"

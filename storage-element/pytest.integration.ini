[pytest]
# ==========================================
# Pytest Configuration для Integration Tests
# ==========================================
# Специальная конфигурация для integration tests
# с настройками для Docker test environment
# ==========================================

# Директории для тестирования
testpaths = tests/integration

# Минимальный уровень вербозности
minversion = 7.0

# Python пути для импорта
pythonpath = .

# Маркеры для категоризации тестов
markers =
    integration: Integration tests (requires Docker environment)
    api: API endpoint tests
    storage: Storage backend tests
    auth: Authentication tests
    slow: Slow-running tests
    requires_db: Tests requiring database
    requires_redis: Tests requiring Redis

# Опции запуска
addopts =
    # Verbose output с именами тестов
    -v
    # Показать короткий traceback при ошибках
    --tb=short
    # Цветной вывод
    --color=yes
    # Показать summary всех результатов
    -ra
    # Показать warnings
    --strict-markers
    # Fail fast на первой ошибке (опционально, закомментировать если нужно)
    # -x
    # Показать локальные переменные в traceback
    -l
    # Показать вывод print statements
    -s

# Игнорировать предупреждения от сторонних библиотек
filterwarnings =
    ignore::DeprecationWarning
    ignore::PendingDeprecationWarning
    # Specific warnings можно добавить здесь

# Timeout для каждого теста (опционально)
# timeout = 300

# Параллельное выполнение (требует pytest-xdist)
# -n auto

# Coverage (опционально, раскомментировать если нужно)
# --cov=app
# --cov-report=html
# --cov-report=term-missing
# --cov-fail-under=80

# Environment variables для integration tests
env =
    TESTING=true
    JWT_PUBLIC_KEY_PATH=/home/artur/Projects/artStore/admin-module/.keys/public_key.pem
    DB_HOST=localhost
    DB_PORT=5433
    DB_USERNAME=artstore_test
    DB_PASSWORD=test_password
    DB_DATABASE=artstore_test
    DB_TABLE_PREFIX=test_storage
    REDIS_HOST=localhost
    REDIS_PORT=6380
    STORAGE_API_URL=http://localhost:8011
    LOG_LEVEL=DEBUG

# Настройки для asyncio tests
asyncio_mode = auto

# Настройки для coverage
[coverage:run]
source = app
omit =
    */tests/*
    */migrations/*
    */__pycache__/*
    */venv/*
    */.venv/*

[coverage:report]
exclude_lines =
    pragma: no cover
    def __repr__
    raise AssertionError
    raise NotImplementedError
    if __name__ == .__main__.:
    if TYPE_CHECKING:
    @abstractmethod

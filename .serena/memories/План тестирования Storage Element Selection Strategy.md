# –ü–ª–∞–Ω —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è Storage Element Selection Strategy

## üìã –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ
- **–í–µ—Ä—Å–∏—è**: 2.0 (—É–ª—É—á—à–µ–Ω–Ω–∞—è)
- **–î–∞—Ç–∞**: 2025-12-03
- **–°—Ç–∞—Ç—É—Å**: Ready for Execution
- **–§–∞–π–ª –∏—Å—Ç–æ—á–Ω–∏–∫**: /home/artur/.claude/plans/smooth-bouncing-globe.md

## üéØ –û—Å–Ω–æ–≤–Ω–∞—è —Ü–µ–ª—å
–ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å Sequential Fill Algorithm —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π:
- –ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ–≥–æ –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è SE –ø–æ priority
- Transitions Capacity Status (OK ‚Üí WARNING ‚Üí CRITICAL ‚Üí FULL)
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –Ω–∞ —Å–ª–µ–¥—É—é—â–∏–π SE –ø—Ä–∏ –∑–∞–ø–æ–ª–Ω–µ–Ω–∏–∏
- Fallback –º–µ—Ö–∞–Ω–∏–∑–º–æ–≤ (Redis ‚Üí Admin API ‚Üí Local Config)
- File Lifecycle Management (TEMPORARY ‚Üí PERMANENT)

## üèóÔ∏è –¢–µ—Å—Ç–æ–≤–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è (3 SE x 1GB)
```
se-01: APP_MODE=edit, PRIORITY=100, MAX_SIZE=1GB
se-02: APP_MODE=edit, PRIORITY=200, MAX_SIZE=1GB
se-03: APP_MODE=rw, PRIORITY=300, MAX_SIZE=1GB
```

## üî¨ 6 –§–∞–∑ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

### –§–ê–ó–ê 0: PRE-FLIGHT
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ –∏ API endpoints
- –ü—Ä–æ–≤–µ—Ä–∫–∞ availability Prometheus –º–µ—Ç—Ä–∏–∫
- –°–±–æ—Ä baseline –º–µ—Ç—Ä–∏–∫

### –§–ê–ó–ê 1: –ü–û–î–ì–û–¢–û–í–ö–ê –°–¢–ï–ù–î–ê
- Backup –¥–∞–Ω–Ω—ã—Ö
- –û—á–∏—Å—Ç–∫–∞ PostgreSQL, MinIO, Redis
- –ú–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏—è docker-compose.yml
- –ü–µ—Ä–µ—Å–±–æ—Ä–∫–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤ –±–µ–∑ cache
- –ó–∞–ø—É—Å–∫ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã –∏ –º–æ–¥—É–ª–µ–π

### –§–ê–ó–ê 2: BASELINE –ú–ï–¢–†–ò–ö–ò
- –°–±–æ—Ä –Ω–∞—á–∞–ª—å–Ω–æ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å–∏—Å—Ç–µ–º—ã
- –ü—Ä–æ–≤–µ—Ä–∫–∞ Redis Service Discovery
- –ü—Ä–æ–≤–µ—Ä–∫–∞ Admin Module registry

### –§–ê–ó–ê 3: –ü–û–ó–ò–¢–ò–í–ù–´–ï –°–¶–ï–ù–ê–†–ò–ò
1. **T1**: 40 —Ñ–∞–π–ª–æ–≤ –≤ se-01 (–ø—Ä–æ–≤–µ—Ä–∫–∞ Sequential Fill)
2. **T2**: –ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ se-01 –¥–æ 96% (–ø—Ä–æ–≤–µ—Ä–∫–∞ transitions)
3. **T3**: Capacity Status Transitions (–¥–µ—Ç–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞)
4. **T4**: –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –Ω–∞ se-02 (FULL se-01)
5. **T5**: 20 —Ñ–∞–π–ª–æ–≤ –≤ se-02
6. **T6**: File Finalization (TEMPORARY‚ÜíPERMANENT)
7. **T7**: –ù–æ–≤—ã–µ —Ñ–∞–π–ª—ã –≤ edit SE (–Ω–µ –≤ rw)

### –§–ê–ó–ê 4: –ù–ï–ì–ê–¢–ò–í–ù–´–ï –°–¶–ï–ù–ê–†–ò–ò
1. **T8**: Fallback –ø—Ä–∏ Redis down (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç Admin API)
2. **T9**: Fallback –ø—Ä–∏ Admin down (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç Local Config)
3. **T10**: –í—Å–µ Edit SE –∑–∞–ø–æ–ª–Ω–µ–Ω—ã (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç RW SE)

### –§–ê–ó–ê 5: –í–ê–õ–ò–î–ê–¶–ò–Ø –†–ï–ó–£–õ–¨–¢–ê–¢–û–í
- –ü—Ä–æ–≤–µ—Ä–∫–∞ MinIO —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤ –Ω–∞ transitions
- –ü—Ä–æ–≤–µ—Ä–∫–∞ Prometheus –º–µ—Ç—Ä–∏–∫
- –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å –∫—Ä–∏—Ç–µ—Ä–∏—è–º–∏ —É—Å–ø–µ—Ö–∞

### –§–ê–ó–ê 6: CLEANUP –ò –û–¢–ß–ï–¢–ù–û–°–¢–¨
- –ì–µ–Ω–µ—Ä–∞—Ü–∏—è TEST-RESULTS.md
- –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–æ–≤
- Rollback –∫ –∏—Å—Ö–æ–¥–Ω–æ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

## üìä –û–∂–∏–¥–∞–µ–º—ã–µ —Ñ–∏–Ω–∞–ª—å–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏
- se-01: 96-100% used, status=FULL (4)
- se-02: 20-30% used, status=OK (1)
- se-03: 2-5% used, status=OK (1)
- storage_element_selected_total{se="se-01"} > 40
- storage_element_selected_total{se="se-02"} ‚â• 20
- file_finalize_total{status="success"} ‚â• 20

## üõ†Ô∏è –¢—Ä–µ–±—É–µ–º—ã–µ —Å–∫—Ä–∏–ø—Ç—ã
1. generate_test_compose.sh - –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç docker-compose.test.yml
2. check_prerequisites.sh - –ø—Ä–æ–≤–µ—Ä–∫–∞ API endpoints
3. upload_test_files.py - –∑–∞–≥—Ä—É–∑–∫–∞ N —Ñ–∞–π–ª–æ–≤
4. fill_storage.py - –∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ SE –¥–æ –ø—Ä–æ—Ü–µ–Ω—Ç–∞
5. validate_health_checks.sh - –ø—Ä–æ–≤–µ—Ä–∫–∞ health
6. collect_baseline_metrics.sh - —Å–±–æ—Ä baseline
7. compare_metrics.py - —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ –º–µ—Ç—Ä–∏–∫
8. generate_test_report.sh - —Ñ–∏–Ω–∞–ª—å–Ω—ã–π –æ—Ç—á–µ—Ç
9. plot_capacity_growth.py - –≥—Ä–∞—Ñ–∏–∫ capacity

## üìö –ö–ª—é—á–µ–≤—ã–µ API endpoints
- POST /api/v1/auth/token (Admin)
- POST /api/v1/upload (Ingester)
- POST /api/v1/finalize/{file_id} (Ingester)
- GET /metrics (–≤—Å–µ –º–æ–¥—É–ª–∏)
- GET /api/v1/storage-elements (Admin)
- GET /health/live, /health/ready (–≤—Å–µ –º–æ–¥—É–ª–∏)

## ‚úÖ –ö—Ä–∏—Ç–µ—Ä–∏–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è
- –í—Å–µ 6 —Ñ–∞–∑ –ø—Ä–æ–π–¥–µ–Ω—ã –±–µ–∑ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –æ—à–∏–±–æ–∫
- TEST-RESULTS.md —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω
- –í—Å–µ –∫—Ä–∏—Ç–µ—Ä–∏–∏ —É—Å–ø–µ—Ö–∞ –∏–∑ 1stTEST.md –≤—ã–ø–æ–ª–Ω–µ–Ω—ã
- –ú–µ—Ç—Ä–∏–∫–∏ –∏ –ª–æ–≥–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –≤ test_artifacts/

## üö® –í–∞–∂–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è
- Sequential Fill –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –°–¢–†–û–ì–ò–ú (—Ñ–∞–π–ª—ã —Å–Ω–∞—á–∞–ª–∞ –≤ se-01, –ø–æ—Ç–æ–º –≤ se-02)
- Retention Policy Routing: TEMPORARY‚Üíedit, PERMANENT‚Üírw
- Adaptive capacity thresholds: WARNING@85%, CRITICAL@92%, FULL@98%
- WEB UI —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ - –æ—Ç–¥–µ–ª—å–Ω—ã–π —Ç–µ—Å—Ç (–ù–ï –≤–∫–ª—é—á–∞—Ç—å –≤ —ç—Ç–æ)

## üìû –û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å
–ü—Ä–∏ –ø—Ä–æ–≤–∞–ª–µ –õ–Æ–ë–û–ì–û —Ç–µ—Å—Ç–∞:
1. –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –¥–∞–ª—å–Ω–µ–π—à–∏—Ö —Ç–µ—Å—Ç–æ–≤
2. –ó–∞–ø–∏—Å–∞—Ç—å –¥–µ—Ç–∞–ª–∏ –æ—à–∏–±–∫–∏ –≤ TEST-RESULTS.md
3. –°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã (–ª–æ–≥–∏, –º–µ—Ç—Ä–∏–∫–∏, MinIO snapshot)
4. –ù–µ –ø—Ä–æ–¥–æ–ª–∂–∞—Ç—å –¥–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø—Ä–æ–±–ª–µ–º—ã
